{% extends "base.html" %}
{% import "macros.html" as macros %}

{% block page_styles %}
    <!-- Config Page -->
    <link href="/css/configure.css" rel="stylesheet">
{% endblock %}

{% block navbar %}
  {% include 'navbar.html' %}
{% endblock %}

{% block content %}
<div class="container content">
  <div class="row">

    {{ macros.nav_pills("instances", settings) }}

    <!-- form on right side -->
    <div class="col-md-10">

      <!-- form header -->
      <div class="row">
        <div class="col-md-12">
          <div class="section-header">
            <h2><small>Appliance Instances</small></h2>
            <p>Instances for this appliance are listed below. Instances with the <span title="Waiting on payment." class="glyphicon glyphicon-time"></span> icon are automatically created by this appliance and assigned Bitcoin addresses from Coinbase. Instances are started, and are kept running, via Bitcoin drip payments from the pool controller. These payments trigger callbacks to the appliance from Coinbase.</p>
            <p>You may manually start an instance using the <span class="glyphicon glyphicon-play"></span> button. Unless a payment is recieved within <strong>15 minutes</strong> to the instance's payment address, the instance will be automatically shutdown and then deprovisioned.</p>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>State</th>
                <th>Instance</th>
                <th>Flavor</th>
                <th>Image</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for instance in instances %}
                <td>{% if instance.state == 0 %}<span class="glyphicon glyphicon-remove-sign"></span>{% elif instance.state == 1 %}<span title="Waiting on payment." class="glyphicon glyphicon-time"></span>{% elif instance.state == 2 %}<span class="glyphicon glyphicon-off"></span>{% elif instance.state == 3 %}<span class="glyphicon glyphicon-play"></span>{% elif instance.state == 4 %}<span class="glyphicon glyphicon-pause"></span>{% elif instance.state == 5 %}<span class="glyphicon glyphicon-fire"></span>{% endif %}</td>
                <td><a href="/configure/instances/{{ instance.id }}">{{ instance.name }}</a></td>
                <td><a href="/configure/flavors/{{ instance.flavor }}">{{ flavors[instance.flavor-1].name }}</a></td>                
                <td>{{ images[instance.image-1].name }}</td>
                <td><button id="instance-detail-{{ instance.token }}" title="Start instance {{ instance.name }}." class="btn btn-xs btn-success"><span class="glyphicon glyphicon-play"></span> Start</button> <button id="instance-detail-{{ instance.token }}" title="Make a payment." class="btn btn-xs btn-danger"><span class="glyphicon glyphicon-qrcode"></span> Payment</button></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascript %}
  <script type="text/javascript">
    $().ready(function() {
      var csrf_token = "{{ csrf_token }}";
    });
  </script>

{% endblock %}

{% block extras %}
    <script src='/js/popovers.js'></script>
{% endblock %}
