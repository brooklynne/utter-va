{% extends "base.html" %}

{% block page_styles %}
    <!-- Config Page -->
    <link href="/css/configure.css" rel="stylesheet">
    <link href='//api.tiles.mapbox.com/mapbox.js/v1.6.0-beta0/mapbox.css' rel='stylesheet'>
{% endblock %}

{% block navbar %}
  {% include 'navbar.html' %}
{% endblock %}

{% block content %}
<div class="container configure-container">
  <ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li class="active">Configure</li>
  </ol>
  <ul class="nav nav-tabs">
    <li><a href="/configure/">Appliance</a></li>
    <li><a href="/configure/openstack/">OpenStack</a></li>
    <li class="active"><a href="/configure/instances/">Flavors & Images</a></li>
  </ul>
  <div>
    <div class="page-header">
      <h2 id="grid">Flavors & Images</h2>
    </div>
    <p>Your appliance needs a minimum of one flavor and one image installed to provide service to users.  Click on the <strong>Install</strong> button next to the entries you want to intsall on your OpenStack cluster.  If you want to deactive a particular flavor or image, click on the <strong>Deactive</strong> button next to the entry.</p>
    <p><em>Flavor and image types are synced hourly from the pool operator.  You can force a sync by clicking the button below.</em></p>
  
    <button class="btn btn-default"><span class="glyphicon glyphicon-refresh"></span> Sync Flavors & Images</button>
    <div class="page-header">
      <h3 id="grid">Instance Flavors {{csrf_token}}</h3>
    </div>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Comment</th>
          <th># VPUs</th>
          <th>Memory (in MB)</th>
          <th>Disk (in GB)</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for flavor in flavors %}
        <tr>
          <td>{{ flavor.id }}</td>
          <td>{{ flavor.name }}</td>
          <td>{{ flavor.comment }}</td>
          <td>{{ flavor.vpu }}</td>
          <td>{{ flavor.mem }}</td>
          <td>{{ flavor.disk }}</td>
          <td><button id="flavor-install-{{ flavor.id }}" class="btn btn-sm btn-success">Install</button></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="page-header">
      <h3 id="grid">System Images</h3>
    </div>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Size (in B)</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for image in images %}
        <tr>
          <td>{{ image.id }}</td>
          <td>{{ image.name }}</td>
          <td>{{ image.size }}</td>
          <td><button id="image-install-{{ image.id }}" class="btn btn-sm btn-success">Install</button></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block javascript %}
  <script type="text/javascript">
    $().ready(function() {
      var csrf_token = "{{ csrf_token }}";
      // refresh memcache of article buttons
      $('button[id^="flavor-install-"]').each(function(index){
        $('#'+this.id).click(function() {
          flavor_id = this.id.split("-").pop();
          console.log(flavor_id);
          $.ajax({
            url: '/api/flavors/'+flavor_id+'/install/'+'?_csrf_token='+csrf_token,
            type: 'POST',
          });
        })
      });
      $('button[id^="image-install-"]').each(function(index){
        $('#'+this.id).click(function() {
          image_id = this.id.split("-").pop();
          console.log(flavor_id);
          $.ajax({
            url: '/api/images/'+image_id+'/install/'+'?_csrf_token='+csrf_token,
            type: 'POST',
          });
        })
      });
    });
  </script>

{% endblock %}

{% block extras %}
    <script src='//api.tiles.mapbox.com/mapbox.js/v1.6.0-beta0/mapbox.js'></script>
{% endblock %}
